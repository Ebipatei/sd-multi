# sd-multi - run multiple Stable Diffusion systems in Docker

**[ Systems and Screenshots üëá](https://github.com/arktronic/sd-multi#system-options)**

## Purpose

I've noticed that some forks of Stable Diffusion, while very active, often break. This repo adds a little bit of stability and predictability, while at the same time allowing the freedom to (relatively easily) play around with different forks/frontends/systems and their features.

Docker is used to provide some isolation between various systems' dependencies beyond what Anaconda can do. It also consolidates input and output locations.

## Usage

For a detailed description of how to get this working in Windows using WSL2 and native Docker (not Docker Desktop), see **[this blog post](https://trycatch.dev/2022/10/01/stable-diffusion-on-wsl2-with-docker/)**.

### Prerequisites

- A modern Nvidia GPU
- Windows 10/11 with [WSL2](https://learn.microsoft.com/en-us/windows/wsl/install) or native Linux
- Lots of free disk space (200+ GB recommended if experimenting)
- [Docker CE](https://docs.docker.com/engine/install/) installed
- [Docker Compose plugin](https://docs.docker.com/compose/install/) installed
- [Nvidia Container Toolkit](https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html#docker) installed
- Git installed in WSL2/Linux
- The file [`sd-v1-4.ckpt`](https://huggingface.co/CompVis/stable-diffusion-v-1-4-original) and/or [`v1-5-pruned-emaonly.ckpt`](https://huggingface.co/runwayml/stable-diffusion-v1-5) from Hugging Face (free registration required)
    - Alternatively, after registering for a Hugging Face account, you can generate a new [token](https://huggingface.co/settings/tokens) for automatic downloading

### Steps

1. Clone this repo to, say, your home directory, and then `cd` into it:
```bash
cd ~
git clone https://github.com/arktronic/sd-multi.git
cd sd-multi
```

2. If *not* using a Hugging Face token, place the `sd-v1-4.ckpt` and/or `v1-5-pruned-emaonly.ckpt` file you downloaded earlier into `~/sd-multi/res/`
3. If you do have a Hugging Face token, copy `env.example` to `.env` inside `~/sd-multi` and edit the `.env` file:
    - Uncomment the `#HUGGINGFACE_TOKEN=` line by removing the `#` in front
    - Insert your Hugging Face token after the equals sign, like so: `HUGGINGFACE_TOKEN=hf_asdfasdfasdfasdfasdf`
4. Run `./verify-resources.sh -d` to verify and download any missing models or weights
    - If you encounter any issues, please make sure they are resolved before continuing to the next step
5. Launch one of the supported forks! (see the fork options below)

All the resources (models and weights) are in `~/sd-multi/res/` and all the output files generated by Stable Diffusion are in `~/sd-multi/output/`.

<!--
Felis catus is your taxonomic nomenclature, an endothermic quadruped, carnivorous by nature
-->

### System options

---

#### ‚≠ê [amotile (stable-diffusion-studio)](https://github.com/amotile/stable-diffusion-studio/), an animation-focused frontend

Launch:
```bash
./run-amotile.sh
```
![image](https://user-images.githubusercontent.com/344911/196015333-f91b9cf7-702d-4207-97b6-aa3504aece8b.png)

(Felis catus wasn't behaving well for these transitions, sorry.)

---

#### ‚≠ê [AUTOMATIC1111](https://github.com/AUTOMATIC1111/stable-diffusion-webui/), one of the most active forks with lots of features and scripts
- includes [Txt2Vectorgraphics](https://github.com/GeorgLegato/Txt2Vectorgraphics) script and [Deforum](https://github.com/deforum-art/deforum-for-automatic1111-webui) extension!
- fine-tuned VAE is enabled

Launch:
```bash
./run-automatic1111.sh
```
![image](https://user-images.githubusercontent.com/344911/196003725-c6bb6624-4900-4fa8-a76f-c1639d86fb96.png)

---

#### ‚≠ê [InvokeAI (a.k.a. lstein)](https://github.com/invoke-ai/InvokeAI/), an early but well-maintained fork (web mode - beautiful interface!)

Launch:
```bash
./run-invokeai-web.sh
```
![image](https://user-images.githubusercontent.com/344911/194965220-d1225e16-9ad0-4093-89e1-f1b60a726719.png)

---

#### ‚≠ê [InvokeAI (a.k.a. lstein)](https://github.com/invoke-ai/InvokeAI/), an early but well-maintained fork (CLI mode)

Launch:
```bash
./run-invokeai-cli.sh
```
![image](https://user-images.githubusercontent.com/344911/194965397-36635481-ae00-4b1b-a38f-9f2dae34a84a.png)

---

#### ‚≠ê [lama-cleaner](https://github.com/Sanster/lama-cleaner), an inpainting/cleaning tool that supports SD and many other models

Launch:
```bash
./run-lama.sh
```
![image](https://user-images.githubusercontent.com/344911/198845701-aba9865b-0f2e-4f03-a332-1bbea567bf8c.png)

---

#### ‚≠ê [osi1880vr (deforum-sd-ui)](https://github.com/osi1880vr/deforum-sd-ui/), a Deforum-based animation/video web UI fork

Launch:
```bash
./run-osi1880vr.sh
```
![image](https://user-images.githubusercontent.com/344911/194966751-77ecd5a3-1bc3-40a1-8fc9-9ffd12e5c99a.png)

---

#### ‚≠ê [Sygil (a.k.a. hlky, sd-webui)](https://github.com/Sygil-Dev/sygil-webui/), an established, easy to use fork (gradio mode)

Launch:
```bash
./run-sygil-gradio.sh
```
![image](https://user-images.githubusercontent.com/344911/194965931-46949452-0103-48f1-bb7a-a149338ed97c.png)

---

#### ‚≠ê [Sygil (a.k.a. hlky, sd-webui)](https://github.com/Sygil-Dev/sygil-webui/), an established, easy to use fork (streamlit mode)

Launch:
```bash
./run-sygil-streamlit.sh
```
![image](https://user-images.githubusercontent.com/344911/194966164-eb4dc5a4-4ad5-43f1-8d7d-254dbacf4f57.png)

---

## Contributing

If you have any ideas for improvements, suggestions of additional forks to add, or anything else, please create an issue and/or open a PR.

_(Maybe there's a cool new fork found in [here](https://github.com/sw-yx/prompt-eng#sd-major-forks) or elsewhere?)_
